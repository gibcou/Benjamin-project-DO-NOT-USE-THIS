import{u as P,j as e}from"./index-B_udihvL.js";import{r as t,L as _}from"./router-C9DcrvDc.js";import{a as g}from"./axios-B9ygI19o.js";import{c as q,d as Q,e as Y}from"./index-D7xXc7HB.js";import{S as M,F as U,f as u,a as f,b as V,c as L,g as W}from"./Sidebar-B4R_yOif.js";import{B as w}from"./BookSkeleton-BmbjG9pU.js";import"./vendor-CRB3T2We.js";import"./icons-N4PBxQYU.js";import"./logo-wOVLm2xr.js";function te(){const{isAuthenticated:z}=P(s=>s.user),[i,A]=t.useState(null),[R,E]=t.useState([]),[T,C]=t.useState([]),[n,b]=t.useState(""),[x,j]=t.useState([]),[N,k]=t.useState([]),[l,D]=t.useState({}),[F,v]=t.useState(!0),[O,S]=t.useState(!0),[$,y]=t.useState(!0),[p,I]=t.useState(!1),B=()=>{I(!p)};return t.useEffect(()=>{const s=async()=>{try{v(!0);const a=await g.get("https://us-central1-summaristt.cloudfunctions.net/getBooks?status=selected");a.data&&a.data[0]&&(A(a.data[0]),k(o=>o.some(m=>m.id===a.data[0].id)?o:[...o,a.data[0]]))}catch(a){console.error("Error fetching selected book:",a)}finally{v(!1)}},d=async()=>{try{S(!0);const a=await g.get("https://us-central1-summaristt.cloudfunctions.net/getBooks?status=recommended");a.data&&(E(a.data.slice(0,8)),k(o=>{const h=new Set(o.map(r=>r.id)),m=a.data.filter(r=>!h.has(r.id));return[...o,...m]}))}catch(a){console.error("Error fetching recommended books:",a)}finally{S(!1)}},c=async()=>{try{y(!0);const a=await g.get("https://us-central1-summaristt.cloudfunctions.net/getBooks?status=suggested");a.data&&(C(a.data.slice(0,8)),k(o=>{const h=new Set(o.map(r=>r.id)),m=a.data.filter(r=>!h.has(r.id));return[...o,...m]}))}catch(a){console.error("Error fetching suggested books:",a)}finally{y(!1)}};s(),d(),c()},[]),t.useEffect(()=>{if(n.trim()===""){j([]);return}const s=async()=>{try{const c=await g.get(`https://us-central1-summaristt.cloudfunctions.net/getBooksByAuthorOrTitle?search=${encodeURIComponent(n)}`);c.data&&j(c.data)}catch(c){console.error("Error fetching search results:",c),j([])}},d=setTimeout(()=>{s()},300);return()=>clearTimeout(d)},[n]),t.useEffect(()=>{const s=async()=>{const d={};await Promise.all(N.map(async c=>{if(c.audioLink)try{const a=await W(c.audioLink);d[c.id]=a}catch(a){console.error(`Error loading duration for ${c.id}:`,a),d[c.id]=null}})),D(d)};N.length>0&&s()},[N]),e.jsxs("div",{className:"for-you-page",children:[e.jsx(M,{isSidebarOpen:p,toggleSidebar:B}),e.jsxs("main",{className:"for-you-content",children:[e.jsxs("div",{className:"fixed-header",children:[e.jsxs("div",{className:"mobile-header-wrapper",children:[e.jsx("button",{className:"hamburger-menu",onClick:B,children:p?e.jsx(q,{}):e.jsx(Q,{})}),e.jsx("div",{className:"search-bar-container",children:e.jsxs("div",{className:"search-bar",children:[e.jsx("input",{type:"text",className:"search-bar__input",placeholder:"Search for books",value:n,onChange:s=>b(s.target.value)}),e.jsx("div",{className:"search-bar__divider"}),e.jsx(Y,{className:"search-bar__icon"})]})})]}),n.trim()!==""&&x.length===0&&e.jsx("div",{className:"search-results",children:e.jsx("div",{className:"search-no-results",children:"No books found"})}),x.length>0&&e.jsx("div",{className:"search-results",children:x.map(s=>e.jsxs(_,{to:`/book/${s.id}`,className:"search-result",onClick:()=>b(""),children:[e.jsx("img",{src:s.imageLink,alt:s.title,className:"search-result__image"}),e.jsxs("div",{className:"search-result__info",children:[e.jsx("h4",{className:"search-result__title",children:s.title}),e.jsx("p",{className:"search-result__author",children:s.author}),e.jsxs("div",{className:"search-result__duration",children:[e.jsx(U,{className:"search-result__play-icon"}),e.jsx("span",{children:s.audioLink?u(l[s.id]):"N/A"})]})]})]},s.id))})]}),e.jsxs("div",{className:"selected-section",children:[e.jsx("h2",{className:"selected-section__title",children:"Selected just for you"}),F?e.jsxs("div",{className:"selected-book skeleton-selected",children:[e.jsx("div",{className:"skeleton__selected-content"}),e.jsx("div",{className:"selected-book__divider"}),e.jsxs("div",{className:"selected-book__details",children:[e.jsx("div",{className:"skeleton__selected-image"}),e.jsxs("div",{className:"skeleton__selected-info",children:[e.jsx("div",{className:"skeleton__selected-title"}),e.jsx("div",{className:"skeleton__selected-author"}),e.jsx("div",{className:"skeleton__selected-duration"})]})]})]}):i?e.jsxs(_,{to:`/book/${i.id}`,className:"selected-book",children:[e.jsx("div",{className:"selected-book__content",children:e.jsx("p",{className:"selected-book__subtitle",children:i.subTitle})}),e.jsx("div",{className:"selected-book__divider"}),e.jsxs("div",{className:"selected-book__details",children:[e.jsx("img",{src:i.imageLink,alt:i.title,className:"selected-book__image"}),e.jsxs("div",{className:"selected-book__info",children:[e.jsx("h3",{className:"selected-book__title",children:i.title}),e.jsx("p",{className:"selected-book__author",children:i.author}),e.jsxs("div",{className:"selected-book__audio",children:[e.jsx(f,{className:"selected-book__play-icon"}),e.jsx("span",{className:"selected-book__duration",children:i.audioLink?V(l[i.id]):"N/A"})]})]})]})]}):e.jsx("div",{className:"selected-book selected-book--loading",children:e.jsx("p",{children:"Loading..."})})]}),e.jsxs("div",{className:"recommended-section",children:[e.jsx("h2",{className:"recommended-section__title",children:"Recommended For You"}),e.jsx("p",{className:"recommended-section__subtitle",children:"We think you'll like these"}),e.jsx("div",{className:"recommended-books",children:e.jsx("div",{className:"recommended-books__slider",children:O?e.jsx(w,{}):R.map(s=>e.jsxs(_,{to:`/book/${s.id}`,className:"recommended-book",children:[s.subscriptionRequired&&e.jsx("span",{className:"recommended-book__premium-badge",children:"Premium"}),e.jsxs("div",{className:"recommended-book__image-wrapper",children:[e.jsx("img",{src:s.imageLink,alt:s.title,className:"recommended-book__image"}),s.audioLink&&e.jsx("span",{className:"recommended-book__duration-overlay",children:u(l[s.id])})]}),e.jsx("h4",{className:"recommended-book__title",children:s.title}),e.jsx("p",{className:"recommended-book__author",children:s.author}),e.jsx("p",{className:"recommended-book__subtitle",children:s.subTitle}),e.jsxs("div",{className:"recommended-book__footer",children:[e.jsxs("div",{className:"recommended-book__audio",children:[e.jsx(f,{className:"recommended-book__play-icon"}),e.jsx("span",{className:"recommended-book__duration",children:s.audioLink?u(l[s.id]):"N/A"})]}),e.jsxs("div",{className:"recommended-book__rating",children:[e.jsx(L,{className:"recommended-book__star-icon"}),e.jsx("span",{children:s.averageRating||"N/A"})]})]})]},s.id))})})]}),e.jsxs("div",{className:"suggested-section",children:[e.jsx("h2",{className:"suggested-section__title",children:"Suggested Books"}),e.jsx("p",{className:"suggested-section__subtitle",children:"Browse those books"}),e.jsx("div",{className:"suggested-books",children:e.jsx("div",{className:"suggested-books__slider",children:$?e.jsx(w,{}):T.map(s=>e.jsxs(_,{to:`/book/${s.id}`,className:"suggested-book",children:[s.subscriptionRequired&&e.jsx("span",{className:"suggested-book__premium-badge",children:"Premium"}),e.jsxs("div",{className:"suggested-book__image-wrapper",children:[e.jsx("img",{src:s.imageLink,alt:s.title,className:"suggested-book__image"}),s.audioLink&&e.jsx("span",{className:"suggested-book__duration-overlay",children:u(l[s.id])})]}),e.jsx("h4",{className:"suggested-book__title",children:s.title}),e.jsx("p",{className:"suggested-book__author",children:s.author}),e.jsx("p",{className:"suggested-book__subtitle",children:s.subTitle}),e.jsxs("div",{className:"suggested-book__footer",children:[e.jsxs("div",{className:"suggested-book__audio",children:[e.jsx(f,{className:"suggested-book__play-icon"}),e.jsx("span",{className:"suggested-book__duration",children:s.audioLink?u(l[s.id]):"N/A"})]}),e.jsxs("div",{className:"suggested-book__rating",children:[e.jsx(L,{className:"suggested-book__star-icon"}),e.jsx("span",{children:s.averageRating||"N/A"})]})]})]},s.id))})})]})]})]})}export{te as default};
