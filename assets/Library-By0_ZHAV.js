import{u as I,j as s,c as B,a as L,e as R}from"./index-B_udihvL.js";import{r as a,L as N}from"./router-C9DcrvDc.js";import{a as b}from"./axios-B9ygI19o.js";import{c as Q,d as W,e as M}from"./index-D7xXc7HB.js";import{S as U,F as f,f as m,c as A,g as V}from"./Sidebar-B4R_yOif.js";import{B as z}from"./BookSkeleton-BmbjG9pU.js";import"./vendor-CRB3T2We.js";import"./icons-N4PBxQYU.js";import"./logo-wOVLm2xr.js";function rs(){const{user:y}=I(e=>e.user),u=y==null?void 0:y.uid,[l,E]=a.useState([]),[c,w]=a.useState([]),[T,g]=a.useState(!0),[D,C]=a.useState(0),[d,O]=a.useState({}),[h,v]=a.useState(""),[_,x]=a.useState([]),[G,F]=a.useState([]),[p,P]=a.useState(!1),k=()=>{P(!p)};return a.useEffect(()=>{const e=()=>{document.visibilityState==="visible"&&C(r=>r+1)};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[]),a.useEffect(()=>{(async()=>{if(!u){g(!1);return}try{const r=B(L,"users",u,"library"),t=(await R(r)).docs.map(n=>({id:n.id,...n.data()}));E(t);const o=B(L,"users",u,"finished"),j=(await R(o)).docs.map(n=>({id:n.id,...n.data()}));w(j)}catch(r){console.error("Error fetching library books:",r)}finally{g(!1)}})()},[u,D]),a.useEffect(()=>{const e=async()=>{const r=[...l,...c],i={};await Promise.all(r.map(async t=>{if(t.audioLink)try{const o=await V(t.audioLink);i[t.id]=o}catch(o){console.error(`Error loading duration for ${t.id}:`,o),i[t.id]=null}})),O(i)};(l.length>0||c.length>0)&&e()},[l,c]),a.useEffect(()=>{(async()=>{try{const[r,i,t]=await Promise.all([b.get("https://us-central1-summaristt.cloudfunctions.net/getBooks?status=selected"),b.get("https://us-central1-summaristt.cloudfunctions.net/getBooks?status=recommended"),b.get("https://us-central1-summaristt.cloudfunctions.net/getBooks?status=suggested")]),S=[...r.data||[],...i.data||[],...t.data||[]].filter((j,n,$)=>n===$.findIndex(q=>q.id===j.id));F(S)}catch(r){console.error("Error fetching books:",r)}})()},[]),a.useEffect(()=>{if(h.trim()===""){x([]);return}const e=async()=>{try{const i=await b.get(`https://us-central1-summaristt.cloudfunctions.net/getBooksByAuthorOrTitle?search=${encodeURIComponent(h)}`);i.data&&x(i.data)}catch(i){console.error("Error fetching search results:",i),x([])}},r=setTimeout(()=>{e()},300);return()=>clearTimeout(r)},[h]),s.jsxs("div",{className:"library-page",children:[s.jsx(U,{isSidebarOpen:p,toggleSidebar:k}),s.jsxs("main",{className:"library-content",children:[s.jsxs("div",{className:"fixed-header",children:[s.jsxs("div",{className:"mobile-header-wrapper",children:[s.jsx("button",{className:"hamburger-menu",onClick:k,children:p?s.jsx(Q,{}):s.jsx(W,{})}),s.jsx("div",{className:"search-bar-container",children:s.jsxs("div",{className:"search-bar",children:[s.jsx("input",{type:"text",className:"search-bar__input",placeholder:"Search for books",value:h,onChange:e=>v(e.target.value)}),s.jsx("div",{className:"search-bar__divider"}),s.jsx(M,{className:"search-bar__icon"})]})})]}),h.trim()!==""&&_.length===0&&s.jsx("div",{className:"search-results",children:s.jsx("div",{className:"search-no-results",children:"No books found"})}),_.length>0&&s.jsx("div",{className:"search-results",children:_.map(e=>s.jsxs(N,{to:`/book/${e.id}`,className:"search-result",onClick:()=>v(""),children:[s.jsx("img",{src:e.imageLink,alt:e.title,className:"search-result__image"}),s.jsxs("div",{className:"search-result__info",children:[s.jsx("h4",{className:"search-result__title",children:e.title}),s.jsx("p",{className:"search-result__author",children:e.author}),s.jsxs("div",{className:"search-result__duration",children:[s.jsx(f,{className:"search-result__play-icon"}),s.jsx("span",{children:e.audioLink?m(d[e.id]):"N/A"})]})]})]},e.id))})]}),s.jsxs("div",{className:"library-section",children:[s.jsx("h2",{className:"library-section__title",children:"Saved Books"}),s.jsxs("p",{className:"library-section__count",children:[l.length," ",l.length===1?"item":"items"]}),T?s.jsx("div",{className:"library-books",children:s.jsx(z,{})}):l.length===0?s.jsxs("div",{className:"library-empty",children:[s.jsx("h3",{className:"library-empty__title",children:"Save your favorite books!"}),s.jsx("p",{className:"library-empty__text",children:"When you save a book, it will appear here."})]}):s.jsx("div",{className:"library-books",children:l.map(e=>s.jsxs(N,{to:`/book/${e.id}`,className:"library-book",children:[e.subscriptionRequired&&s.jsx("span",{className:"library-book__premium-badge",children:"Premium"}),s.jsxs("div",{className:"library-book__image-wrapper",children:[s.jsx("img",{src:e.imageLink,alt:e.title,className:"library-book__image"}),e.audioLink&&s.jsx("span",{className:"library-book__duration-overlay",children:m(d[e.id])})]}),s.jsx("h4",{className:"library-book__title",children:e.title}),s.jsx("p",{className:"library-book__author",children:e.author}),s.jsx("p",{className:"library-book__subtitle",children:e.subTitle}),s.jsxs("div",{className:"library-book__footer",children:[s.jsxs("div",{className:"library-book__audio",children:[s.jsx(f,{className:"library-book__play-icon"}),s.jsx("span",{className:"library-book__duration",children:e.audioLink?m(d[e.id]):"N/A"})]}),s.jsxs("div",{className:"library-book__rating",children:[s.jsx(A,{className:"library-book__star-icon"}),s.jsx("span",{children:e.averageRating||"N/A"})]})]})]},e.id))})]}),s.jsxs("div",{className:"library-section",children:[s.jsx("h2",{className:"library-section__title",children:"Finished"}),s.jsxs("p",{className:"library-section__count",children:[c.length," ",c.length===1?"item":"items"]}),c.length===0?s.jsxs("div",{className:"library-empty",children:[s.jsx("h3",{className:"library-empty__title",children:"Done and dusted!"}),s.jsx("p",{className:"library-empty__text",children:"When you finish a book, you can find it here later."})]}):s.jsx("div",{className:"library-books",children:c.map(e=>s.jsxs(N,{to:`/book/${e.id}`,className:"library-book",children:[e.subscriptionRequired&&s.jsx("span",{className:"library-book__premium-badge",children:"Premium"}),s.jsxs("div",{className:"library-book__image-wrapper",children:[s.jsx("img",{src:e.imageLink,alt:e.title,className:"library-book__image"}),e.audioLink&&s.jsx("span",{className:"library-book__duration-overlay",children:m(d[e.id])})]}),s.jsx("h4",{className:"library-book__title",children:e.title}),s.jsx("p",{className:"library-book__author",children:e.author}),s.jsx("p",{className:"library-book__subtitle",children:e.subTitle}),s.jsxs("div",{className:"library-book__footer",children:[s.jsxs("div",{className:"library-book__audio",children:[s.jsx(f,{className:"library-book__play-icon"}),s.jsx("span",{className:"library-book__duration",children:e.audioLink?m(d[e.id]):"N/A"})]}),s.jsxs("div",{className:"library-book__rating",children:[" ",s.jsx(A,{className:"library-book__star-icon"})," ",s.jsx("span",{children:e.averageRating||"N/A"})]})]})]},e.id))})]})]})]})}export{rs as default};
