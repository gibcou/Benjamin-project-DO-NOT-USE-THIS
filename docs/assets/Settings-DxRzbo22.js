import{f as E,u as C,j as s,d as D,a as R,s as O,h as T}from"./index-Btlnb-aJ.js";import{c as L,r,L as P}from"./router-C9DcrvDc.js";import{a as o}from"./axios-B9ygI19o.js";import{c as I,d as $,e as F}from"./index-D7xXc7HB.js";import{S as U,F as Y,f as Q,g as q}from"./Sidebar-DA-yhK2D.js";import"./vendor-CRB3T2We.js";import"./icons-N4PBxQYU.js";import"./logo-HRwc8ssv.js";function ss(){const f=L(),x=E(),{isAuthenticated:M,user:t}=C(e=>e.user),[c,g]=r.useState(""),[l,u]=r.useState([]),[d,j]=r.useState([]),[N,b]=r.useState({}),[m,_]=r.useState(!1),p=()=>{_(!m)},h=(t==null?void 0:t.isSubscribed)||!1,S=(t==null?void 0:t.email)||"";r.useEffect(()=>{(async()=>{try{const[a,i,n]=await Promise.all([o.get("https://us-central1-summaristt.cloudfunctions.net/getBooks?status=selected"),o.get("https://us-central1-summaristt.cloudfunctions.net/getBooks?status=recommended"),o.get("https://us-central1-summaristt.cloudfunctions.net/getBooks?status=suggested")]),y=[...a.data||[],...i.data||[],...n.data||[]].filter((A,k,w)=>k===w.findIndex(B=>B.id===A.id));j(y)}catch(a){console.error("Error fetching books:",a)}})()},[]),r.useEffect(()=>{if(c.trim()===""){u([]);return}const e=async()=>{try{const i=await o.get(`https://us-central1-summaristt.cloudfunctions.net/getBooksByAuthorOrTitle?search=${encodeURIComponent(c)}`);i.data&&u(i.data)}catch(i){console.error("Error fetching search results:",i),u([])}},a=setTimeout(()=>{e()},300);return()=>clearTimeout(a)},[c]),r.useEffect(()=>{const e=async()=>{const a={};await Promise.all(d.map(async i=>{if(i.audioLink)try{const n=await q(i.audioLink);a[i.id]=n}catch(n){console.error(`Error loading duration for ${i.id}:`,n),a[i.id]=null}})),b(a)};d.length>0&&e()},[d]);const v=async()=>{if(h){if(!(t!=null&&t.uid)){alert("Please log in to manage your subscription");return}if(window.confirm("Are you sure you want to cancel your subscription? You will lose access to premium features."))try{const a=D(R,"users",t.uid);await O(a,{isSubscribed:!1,subscriptionType:null,cancelledDate:new Date().toISOString()},{merge:!0}),x(T({...t,isSubscribed:!1,subscriptionType:null})),alert("Your subscription has been cancelled.")}catch(a){console.error("Error cancelling subscription:",a),alert(`Failed to cancel subscription: ${a.message}`)}}else f("/choose-plan")};return s.jsxs("div",{className:"settings-page",children:[s.jsx(U,{isSidebarOpen:m,toggleSidebar:p}),s.jsxs("main",{className:"settings-content",children:[s.jsxs("div",{className:"fixed-header",children:[s.jsxs("div",{className:"mobile-header-wrapper",children:[s.jsx("button",{className:"hamburger-menu",onClick:p,children:m?s.jsx(I,{}):s.jsx($,{})}),s.jsx("div",{className:"search-bar-container",children:s.jsxs("div",{className:"search-bar",children:[s.jsx("input",{type:"text",className:"search-bar__input",placeholder:"Search for books",value:c,onChange:e=>g(e.target.value)}),s.jsx("div",{className:"search-bar__divider"}),s.jsx(F,{className:"search-bar__icon"})]})})]}),c.trim()!==""&&l.length===0&&s.jsx("div",{className:"search-results",children:s.jsx("div",{className:"search-no-results",children:"No books found"})}),l.length>0&&s.jsx("div",{className:"search-results",children:l.map(e=>s.jsxs(P,{to:`/book/${e.id}`,className:"search-result",onClick:()=>g(""),children:[s.jsx("img",{src:e.imageLink,alt:e.title,className:"search-result__image"}),s.jsxs("div",{className:"search-result__info",children:[s.jsx("h4",{className:"search-result__title",children:e.title}),s.jsx("p",{className:"search-result__author",children:e.author}),s.jsxs("div",{className:"search-result__duration",children:[s.jsx(Y,{className:"search-result__play-icon"}),s.jsx("span",{children:e.audioLink?Q(N[e.id]):"N/A"})]})]})]},e.id))})]}),s.jsxs("div",{className:"settings-container",children:[s.jsx("h1",{className:"settings-title",children:"Settings"}),s.jsx("div",{className:"settings-divider"}),s.jsxs("div",{className:"settings-section",children:[s.jsx("h2",{className:"settings-section__title",children:"Your subscription plan"}),s.jsx("p",{className:"settings-section__status",children:h?(t==null?void 0:t.subscriptionType)||"Premium":"Basic"}),s.jsx("button",{className:"settings-section__btn",onClick:v,children:h?"Cancel plan":"Upgrade to Premium"})]}),s.jsx("div",{className:"settings-divider"}),s.jsxs("div",{className:"settings-section",children:[s.jsx("h2",{className:"settings-section__title",children:"Email"}),s.jsx("p",{className:"settings-section__email",children:S})]})]})]})]})}export{ss as default};
